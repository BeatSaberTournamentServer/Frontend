<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
	<title>WebUI</title>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://danesaber.cf/assets/js/notiflix-aio-3.2.5.min.js"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins&amp;display=swap">
	<link rel="stylesheet" href="./assets/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="./assets/css/Dark-NavBar-Navigation-with-Button.css">
	<link rel="stylesheet" href="./assets/css/Dark-NavBar-Navigation-with-Search.css">
	<link rel="stylesheet" href="./assets/css/Dark-NavBar.css">
	<link rel="stylesheet" href="./assets/css/Navbar-Right-Links-Dark-icons.css">
</head>

<body style="background: rgb(40,40,40);">
	<nav class="navbar navbar-dark navbar-expand-md bg-dark py-3" style="z-index: 10;">
		<div class="container"><a class="navbar-brand d-flex align-items-center" href="#">
				<span
					class="bs-icon-sm bs-icon-rounded bs-icon-primary d-flex justify-content-center align-items-center me-2 bs-icon"><svg
						class="bi bi-trophy-fill" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
						fill="currentColor" viewBox="0 0 16 16">
						<path
							d="M2.5.5A.5.5 0 0 1 3 0h10a.5.5 0 0 1 .5.5c0 .538-.012 1.05-.034 1.536a3 3 0 1 1-1.133 5.89c-.79 1.865-1.878 2.777-2.833 3.011v2.173l1.425.356c.194.048.377.135.537.255L13.3 15.1a.5.5 0 0 1-.3.9H3a.5.5 0 0 1-.3-.9l1.838-1.379c.16-.12.343-.207.537-.255L6.5 13.11v-2.173c-.955-.234-2.043-1.146-2.833-3.012a3 3 0 1 1-1.132-5.89A33.076 33.076 0 0 1 2.5.5zm.099 2.54a2 2 0 0 0 .72 3.935c-.333-1.05-.588-2.346-.72-3.935zm10.083 3.935a2 2 0 0 0 .72-3.935c-.133 1.59-.388 2.885-.72 3.935z">
						</path>
					</svg></span>
				<span style="font-family: Poppins, sans-serif;">Tournament WEBUI</span></a>
			<button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-5"><span
					class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
			<div class="collapse navbar-collapse" id="navcol-5">
				<ul class="navbar-nav ms-auto"></ul>
				<a class="btn btn-primary ms-md-2" role="button" href="#"
					style="font-family: Poppins, sans-serif;background: rgb(101, 180, 58);--bs-primary: #3cb43a;--bs-primary-rgb: 180,58,58;border-color: #2a642a !important;"
					onclick="reload();">Reload Overlay</a>
				<a class="btn btn-primary ms-md-2" role="button" href="#"
					style="font-family: Poppins, sans-serif;background: rgb(180,58,58);--bs-primary: #b43a3a;--bs-primary-rgb: 180,58,58;border-color: #b43a3a !important;"
					onclick="reset();">Reset</a>
				<a class="btn btn-primary ms-md-2" id="reconnect" role="button" href="#"
					style="transition: all 0.5s linear; opacity: 0; font-family: Poppins, sans-serif;background: rgb(58, 80, 180);--bs-primary: rgb(58, 80, 180);--bs-primary-rgb: 180,58,58;border-color: rgb(58, 80, 180) !important;"
					onclick="reconnect();">Reconnect to WebSocket</a>
			</div>
		</div>
	</nav>
	<div class="container" style="height: 134px;padding-top: 35px;border-top-left-radius: 10px;">
		<div class="row">
			<div id="BRDIV" class="col-md-6 col-xxl-5 align-self-center m-auto"
				style="height: 650px;width: 850px;padding: 0px;padding-right: 12px;border-top-left-radius: 10px;border-top-right-radius: 10px;background: linear-gradient(#212121 13%, #373737 13%), #373737;margin: 5px;border-bottom-right-radius: 10px;border-bottom-left-radius: 10px;color: rgb(33, 37, 41);text-align: center;">
				<h1 class="text-center"
					style="text-align: center;font-family: Poppins, sans-serif;color: rgb(211,211,211);padding: 0px;padding-top: 19px;">
					Overlay Controls</h1>
				<section class="position-relative py-4 py-xl-5">
					<div class="container position-relative">
						<div class="row d-flex justify-content-center">
							<div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4"
								style="width: 790px;display: inline-flex;justify-content: space-around;">
								<div class="card mb-5">
									<div class="card-body p-sm-5">
										<h2 class="text-center mb-4" id="header">Set score/status</h2>
										<form method="post">
											<div class="mb-3">
												<select required id="playerScreenNames" class="form-control" type="text"
													name="name" placeholder="Select a User" disabled />
												<option value="" disabled selected>Select player</option>
												</select>
											</div>
											<div class="mb-3">
												<input required id="score" class="form-control" type="number" name="score" placeholder="0" disabled />
											</div>
											<div class="mb-3">
												<select required id="alive" class="form-control" type="text" name="name"
													placeholder="Is player alive?" disabled />
												<option value="" disabled selected>Is user alive?</option>
												<option value="true">Yes</option>
												<option value="false">No</option>
												</select>
											</div>
											<div>
												<button id="playerScreen" type="button"
													class="btn btn-primary d-block w-100"
													onclick="sendToOverlay('playerScreen')" disabled>Send </button>
											</div>
										</form>
									</div>
								</div>
								<div class="card mb-5">
									<div class="card-body p-sm-5">
										<h2 class="text-center mb-4" id="header">Spectator Setting</h2>
										<form method="post">
											<div class="mb-3">
												<select required id="playerSpectatingNames" class="form-control" type="text" name="name" placeholder="Select a User" disabled>
												<option value="" disabled selected>Select player</option>
												</select>
											</div>
											<div class="mb-3">
												<input required="" id="ACCGoal" class="form-control" type="number" name="ACCGoal" max="100" placeholder="ACC Goal" disabled>
											</div>
											<div>
												<button id="playerSpec" type="button"
													class="btn btn-primary d-block w-100"
													onclick="sendToOverlay('playerSpec')" disabled>Send </button>
											</div>
										</form>
										<form method="post">
											<div><br>
												<button id="playerResetSpec" type="button"
													class="btn btn-secondary d-block w-100"
													onclick="sendToOverlay('resetSpec')"
													style="background-color: #9d3d3d;">Reset</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
			<div id="VERSUSDIV" class="col-md-6 col-xxl-5 align-self-center m-auto"
				style="height: auto;width: 850px;padding: 0px;padding-right: 12px;border-top-left-radius: 10px;border-top-right-radius: 10px;background: linear-gradient(#212121 10%, #373737 10%), #373737;margin: 5px;border-bottom-right-radius: 10px;border-bottom-left-radius: 10px;color: rgb(33, 37, 41);text-align: center;">
				<h1 class="text-center"
					style="text-align: center;font-family: Poppins, sans-serif;color: rgb(211,211,211);padding: 0px;padding-top: 19px;">
					Overlay Controls</h1>
				<section class="position-relative py-4 py-xl-5">
					<div class="container position-relative">
						<div class="row d-flex justify-content-center">
							<div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4"
								style="width: 790px;display: inline-flex;justify-content: space-around;flex-wrap: wrap;">
								<div class="card mb-5">
									<div class="card-body p-sm-5">
										<h2 class="text-center mb-4">Control score</h2>
										<form method="post">
											<div>
												<p id="P1Name">{player1Name} - Score</p>
												<span style="display: flex;"><input id="P1ScoreSlider"
														class="form-range form-control" type="range" min="0" max="0"
														value="0" step="1"
														oninput="this.nextElementSibling.value = this.value" disabled />
													<output style="padding-left: 16px;">0</output></span>
											</div>
											<div style="margin-top: 32px;">
												<p id="P2Name">{player2Name} - Score</p>
												<span style="display: flex;"><input id="P2ScoreSlider"
														class="form-range form-control" type="range" min="0" max="0"
														value="0" step="1"
														oninput="this.nextElementSibling.value = this.value" disabled />
													<output style="padding-left: 16px;">0</output></span>
											</div>
											<br>
											<button id="playerScore" type="button" class="btn btn-primary d-block w-100"
												onclick="sendToOverlay('sendScore')" disabled>Send </button>
										</form>
									</div>
								</div>
								<div class="card mb-5">
									<div class="card-body p-sm-5">
										<h2 class="text-center mb-4" id="header">Picks&Bans</h2>
										<div class="SongDivs" id="SongDivs">
											<img id="SongCircle" src="../PB/Images/Player2.png"
												onclick="PB('songHashHere');" class="SongCircle"
												style="display:none;" />
										</div>
									</div>
								</div>
								<div class="card mb-5">
									<div class="card-body p-sm-5">
										<h2 class="text-center mb-4" id="header">Current map</h2>
										<form method="post">
											<div class="mb-3">
												<select required id="currentMap" class="form-control" type="text"
													name="name" placeholder="Select a map" disabled />
												<option value="" disabled selected>Select map</option>
												</select>
											</div>
											<div>
												<button id="mapPlaying" type="button"
													class="btn btn-primary d-block w-100"
													onclick="sendToOverlay('currentMap')" disabled>Send </button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
			<div id="MATCHDIV" class="col-md-6 col-xxl-5 align-self-center m-auto"
				style="height: auto;width: 850px;padding: 0px;padding-right: 12px;border-top-left-radius: 10px;border-top-right-radius: 10px;background: linear-gradient(#212121 5.5em, #373737 5.5em), #373737;margin: 5px;border-bottom-right-radius: 10px;border-bottom-left-radius: 10px;color: rgb(33, 37, 41);text-align: center;">
				<h1 class="text-center"
					style="text-align: center;font-family: Poppins, sans-serif;color: rgb(211,211,211);padding: 0px;padding-top: 19px;">
					Select a match!</h1>
				<section class="position-relative py-4 py-xl-5">
					<div class="container position-relative">
						<div class="row d-flex justify-content-center">
							<div class="col-md-8 col-lg-6 col-xl-5 col-xxl-4"
								style="width: 790px;display: inline-flex;justify-content: space-around;flex-wrap: wrap;">
								<div class="card mb-5">
									<div class="card-body p-sm-5">
										<h2 class="text-center mb-4" id="header">Select Match</h2>
										<form method="post">
											<div class="mb-3">
												<select style="text-align: center;" required="" id="currentMatch"
													class="form-control" type="text" name="name"
													placeholder="Select a match">
													<option value="Select" disabled="" selected="">Select a match!
													</option>
												</select>
											</div>
											<div>
												<button id="selectMatch" type="button"
													class="btn btn-primary d-block w-100"
													onclick="sendToOverlay('selectMatch')">Send</button>
												<br>
												<button id="requestMatches" type="button"
													class="btn btn-primary d-block w-100"
													onclick="sendToOverlay('requestMatches')">Request
													match-list</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script src="./assets/js/jquery.min.js"></script>
	<script src="./assets/bootstrap/js/bootstrap.min.js"></script>
	<script src="./assets/js/init.js"></script>
	<script>
		function sendToOverlay(type) {
			if (type == "requestMatches") {
				ws.send(JSON.stringify({ 'Type': '5', 'command': 'requestMatches' }));
			} else if (type == "selectMatch") {
				//Get the selected match
				let selectedMatch = $('#currentMatch').find(':selected');
				//Get the match data
				//If the index is 0, then the match is not selected
				if (selectedMatch.index() == 0) {
					alert("Please select a match");
					return;
				} else {
					//Get the data-player1-name, data-player2-name, data-player1-id, data-player2-id
					P1 = selectedMatch.data("player1-id");
					P2 = selectedMatch.data("player2-id");
					matchId = selectedMatch.data("match-id");
					configure();
				}
			} else if (type == "playerScreen") {
				//check if alive is not null
				if (document.getElementById("playerScreenNames").value != "") {
					if (document.getElementById("alive").value != "") {
						var username = document.getElementById("playerScreenNames").options[document.getElementById("playerScreenNames").selectedIndex].text;
						var userid = document.getElementById("playerScreenNames").value;
						var score = document.getElementById("score").value;
						var alive = document.getElementById("alive").value;
						ws.send(JSON.stringify({ 'Type': '6', 'command': 'updateScore', 'PlayerId': userid, 'score': score, 'alive': alive, 'count': (document.getElementById("playerScreenNames").options.length-2) }));
						if (alive == "false") {
							var select = document.getElementById("playerSpectatingNames");
							for (var i = 0; i < select.options.length; i++) {
								if (select.options[i].text == username) {
									select.remove(i);
								}
							}
							document.getElementById("score").value = "";
							document.getElementById("playerScreenNames").selectedIndex = 0;
							document.getElementById("alive").selectedIndex = 0;
							$("#playerScreenNames option[value='" + userid + "']").remove();
							$("#playerSpectatingNames option[value='" + username + "']").remove();
						}
						//Get length of select

					}
				}
				if (debug) {
					console.log(JSON.stringify({ 'Type': '6', 'command': 'updateScore', 'PlayerId': userid, 'score': score, 'alive': alive }));
				}
			} else if (type == "playerSpec") {
				specUsername = document.getElementById("playerSpectatingNames").options[document.getElementById("playerSpectatingNames").selectedIndex].text;
				specTwitchname = document.getElementById("playerSpectatingNames").value;
				ACCGoal = document.getElementById("ACCGoal").value;
				ws.send(JSON.stringify({ 'Type': '6', 'command': 'updateSpectator','Player':specUsername,'Twitch':specTwitchname,'ACCGoal': ACCGoal}));
			} else if (type == "resetSpec") {
				ws.send(JSON.stringify({ 'Type': '6', 'command': 'resetSpectator' }));
			} else if (type == "currentMap") {
				//Get data-price from currentMap
				var hash = document.getElementById("currentMap").value;
				var diff = document.getElementById("currentMap").options[document.getElementById("currentMap").selectedIndex].getAttribute("data-price");
				var player = document.getElementById("currentMap").options[document.getElementById("currentMap").selectedIndex].getAttribute("data-player");
				switch (diff.toLowerCase()) {
					case "easy":
						diff = 0;
						break;
					case "normal":
						diff = 1;
						break;
					case "hard":
						diff = 2;
						break;
					case "expert":
						diff = 3;
						break;
					case "expertplus":
						diff = 4;
						break;
					default:
						diff = 0;
						break;
				}
				ws.send(JSON.stringify({ 'Type': '3', 'overlay': '1V1', 'LevelId': hash, 'Diff': diff, 'MatchId': matchId, 'Player': player }));
			} else if (type == "sendScore") {
				var p1Score = document.getElementById("P1ScoreSlider").value;
				var p2Score = document.getElementById("P2ScoreSlider").value;
				if (debug) {
					console.log(PlayerInfo[0][0] + " | Score: " + p1Score + " - " + PlayerInfo[1][0] + " | Score: " + p2Score);
				}
				ws.send(JSON.stringify({ 'Type': '5', 'command': 'updateScore', 'PlayerIds': [P1, P2], 'Score': [p1Score, p2Score] }));
			}
		}

		ws.onmessage = async function (event) {
			parsedData = JSON.parse(event.data);
			// console.log(parsedData);
			if (parsedData.Type == 1) {
				// Append the match toe CurrentMatch with the
				//If player 2 is null, then it is a single player match
				if (parsedData.message.matchData.players.length == 1) {
					$('#currentMatch').append(`
					<option 
					data-match-id="${parsedData.message.matchData.matchId}"
					data-coordinator-name="${parsedData.message.matchData.coordinator.name}"
					data-coordinator-id="${parsedData.message.matchData.coordinator.id}"
					data-player1-name="${parsedData.message.matchData.players[0].name}"
					data-player1-id="${parsedData.message.matchData.players[0].user_id}"
					data-player1-guid="${parsedData.message.matchData.players[0].guid}"
					data-player2-name="Player 2"}"
					data-player2-id="76561197992369547"}"
					data-player2-guid="0"}"
					>${parsedData.message.matchData.players[0].name} vs Player 2 Placeholder</option>
					`);
				} else if (parsedData.message.matchData.players.length == 2) {
					$('#currentMatch').append(`
					<option 
					data-match-id="${parsedData.message.matchData.matchId}"
					data-coordinator-name="${parsedData.message.matchData.coordinator.name}"
					data-coordinator-id="${parsedData.message.matchData.coordinator.id}"
					data-player1-name="${parsedData.message.matchData.players[0].name}"
					data-player1-id="${parsedData.message.matchData.players[0].user_id}"
					data-player1-guid="${parsedData.message.matchData.players[0].guid}"
					data-player2-name="${parsedData.message.matchData.players[1].name}"
					data-player2-id="${parsedData.message.matchData.players[1].user_id}"
					data-player2-guid="${parsedData.message.matchData.players[1].guid}"
					>${parsedData.message.matchData.players[0].name} vs ${parsedData.message.matchData.players[1].name}</option>
					`);
				}
			}
			if (parsedData.Type == 2) {
				console.log("Match Deleted");
				//Remove the option with data-match-id matching the deleted match
				$('#currentMatch option[data-match-id="' + parsedData.message.matchData.matchId + '"]').remove();
				//Set the current match to Select map
				document.getElementById("currentMatch").selectedIndex = 0;
			}
			if (parsedData.Type == 5) {
				if (parsedData.command == "returnMatches") {
					//Check parsedData.message for matches
					if (parsedData.message == "No matches found") {
						console.log("No matches found");
						Notiflix.Notify.failure("No matches was found", { plainText: false, clickToClose: true, timeout: 5000, position: 'right-bottom' });
					} else if (parsedData.message !== "No matches found") {
						Notiflix.Notify.success("Updated matchlist", { plainText: false, clickToClose: true, timeout: 5000, position: 'right-bottom' });
						//If parsedData.message.matches[i].matchData.matchId is not in the currentMatch dropdown, then add it
						for (var i = 0; i < parsedData.message.matches.length; i++) {
							if ($('#currentMatch option[data-match-id="' + parsedData.message.matches[i].matchData.matchId + '"]').length) {
							} else {
								console.log(parsedData.message.matches[i].matchData);
								//Append the match to CurrentMatch options
								//If player 2 is null, then it is a single player match
								if (parsedData.message.matches[i].matchData.players.length == 1) {
									$('#currentMatch').append(`
								<option 
								data-match-id="${parsedData.message.matches[i].matchData.matchId}"
								data-coordinator-name="${parsedData.message.matches[i].matchData.coordinator.name}"
								data-coordinator-id="${parsedData.message.matches[i].matchData.coordinator.id}"
								data-player1-name="${parsedData.message.matches[i].matchData.players[0].name}"
								data-player1-id="${parsedData.message.matches[i].matchData.players[0].user_id}"
								data-player1-guid="${parsedData.message.matches[i].matchData.players[0].guid}"
								data-player2-name="Player 2"}"
								data-player2-id="76561197992369547"}"
								data-player2-guid="0"}"
								>${parsedData.message.matches[i].matchData.players[0].name} vs Player 2 Placeholder</option>
								`);
								} else if (parsedData.message.matches[i].matchData.players.length == 2) {
									$('#currentMatch').append(`
								<option 
								data-match-id="${parsedData.message.matches[i].matchData.matchId}"
								data-coordinator-name="${parsedData.message.matches[i].matchData.coordinator.name}"
								data-coordinator-id="${parsedData.message.matches[i].matchData.coordinator.id}"
								data-player1-name="${parsedData.message.matches[i].matchData.players[0].name}"
								data-player1-id="${parsedData.message.matches[i].matchData.players[0].user_id}"
								data-player1-guid="${parsedData.message.matches[i].matchData.players[0].guid}"
								data-player2-name="${parsedData.message.matches[i].matchData.players[1].name}"
								data-player2-id="${parsedData.message.matches[i].matchData.players[1].user_id}"
								data-player2-guid="${parsedData.message.matches[i].matchData.players[1].guid}"
								>${parsedData.message.matches[i].matchData.players[0].name} vs ${parsedData.message.matches[i].matchData.players[1].name}</option>
								`);
								}
							}
						}
					}
				}
			}
		};
	</script>
</body>

</html>